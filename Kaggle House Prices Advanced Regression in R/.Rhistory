knitr::opts_chunk$set(echo = TRUE)
#Load packages
library(tidyverse)
library(ggplot2)
library(caret)
#install.packages("imputeMissings")
library(imputeMissings)
#Load data
train <- read_csv("train.csv")
test <- read_csv("test.csv")
d <- train
t <- test
#Explore Outcome Variable
hist(d$SalePrice)
#Outcome variable SalePrice is skewed. Log transform in model.
#Log transform the outcome variable
hist(log(d$SalePrice))
#Now the distribution looks more normal
#Explore and transform variables
#OverallQual
sum(is.na(d$OverallQual))
sum(is.na(t$OverallQual))
#Neighborhood
sum(is.na(d$Neighborhood))
sum(is.na(t$Neighborhood))
#YearSold
sum(is.na(d$YrSold))
sum(is.na(t$YrSold))
#YearBuilt
sum(is.na(d$YearBuilt))
sum(is.na(t$YearBuilt))
#YearRemodAdd
sum(is.na(d$YearRemodAdd))
sum(is.na(t$YearRemodAdd))
#MasVnrArea
sum(is.na(d$MasVnrArea))
d$MasVnrArea[is.na(d$MasVnrArea)] <- median(d$MasVnrArea, na.rm = TRUE)
sum(is.na(d$MasVnrArea))
sum(is.na(t$MasVnrArea))
t$MasVnrArea[is.na(t$MasVnrArea)] <- median(t$MasVnrArea, na.rm = TRUE)
sum(is.na(t$MasVnrArea))
#ExterQual
sum(is.na(d$ExterQual))
sum(is.na(t$ExterQual))
#BsmtQual
sum(is.na(d$BsmtQual))
d$BsmtQual = as.factor(ifelse(is.na(d$BsmtQual), "No Basement", d$BsmtQual))
sum(is.na(d$BsmtQual))
table(d$BsmtQual)
sum(is.na(t$BsmtQual))
t$BsmtQual = as.factor(ifelse(is.na(t$BsmtQual), "No Basement", t$BsmtQual))
sum(is.na(t$BsmtQual))
table(t$BsmtQual)
#TotalBsmtSF
sum(is.na(d$TotalBsmtSF))
sum(is.na(t$TotalBsmtSF))
which(is.na(t$TotalBsmtSF))
t$TotalBsmtSF[is.na(t$TotalBsmtSF)] <- median(t$TotalBsmtSF, na.rm = TRUE)
sum(is.na(t$TotalBsmtSF))
t$TotalBsmtSF[661]
#BsmtFinSF1
sum(is.na(d$BsmtFinSF1))
sum(is.na(t$BsmtFinSF1))
t$BsmtFinSF1[is.na(t$BsmtFinSF1)] <- median(t$BsmtFinSF1, na.rm = TRUE)
sum(is.na(t$BsmtFinSF1))
#BsmtFinSF2
sum(is.na(d$BsmtFinSF2))
sum(is.na(t$BsmtFinSF2))
t$BsmtFinSF2[is.na(t$BsmtFinSF2)] <- median(t$BsmtFinSF2, na.rm = TRUE)
sum(is.na(t$BsmtFinSF2))
#BsmtFinType1
sum(is.na(d$BsmtFinType1))
d$BsmtFinType1 = as.factor(ifelse(is.na(d$BsmtFinType1), "No Basement", d$BsmtFinType1))
sum(is.na(d$BsmtFinType1))
table(d$BsmtFinType1)
sum(is.na(t$BsmtFinType1))
t$BsmtFinType1 = as.factor(ifelse(is.na(t$BsmtFinType1), "No Basement", t$BsmtFinType1))
sum(is.na(t$BsmtFinType1))
table(t$BsmtFinType1)
#X1stFlrSF
sum(is.na(d$`1stFlrSF`))
sum(is.na(t$`1stFlrSF`))
#X2ndFlrSF
sum(is.na(d$`2ndFlrSF`))
sum(is.na(t$`2ndFlrSF`))
#GrLivArea
sum(is.na(d$GrLivArea))
sum(is.na(t$GrLivArea))
#Fireplaces
sum(is.na(d$Fireplaces))
sum(is.na(t$Fireplaces))
#FullBath
sum(is.na(d$FullBath))
sum(is.na(t$FullBath))
#BsmtFullBath
sum(is.na(d$BsmtFullBath))
sum(is.na(t$BsmtFullBath))
t$BsmtFullBath[is.na(t$BsmtFullBath)] <- median(t$BsmtFullBath, na.rm = TRUE)
sum(is.na(t$BsmtFullBath))
#HalfBath
sum(is.na(d$HalfBath))
sum(is.na(t$HalfBath))
#BsmtHalfBath
sum(is.na(d$BsmtHalfBath))
sum(is.na(t$BsmtHalfBath))
t$BsmtHalfBath[is.na(t$BsmtHalfBath)] <- median(t$BsmtHalfBath, na.rm = TRUE)
sum(is.na(t$BsmtHalfBath))
#KitchenQual
sum(is.na(d$KitchenQual))
t$KitchenQual <- (ifelse((is.na(t$KitchenQual)), 'TA', t$KitchenQual))
sum(is.na(t$KitchenQual))
#GarageCars
sum(is.na(d$GarageCars))
sum(is.na(t$GarageCars))
which(is.na(t$GarageCars))
t$GarageCars[is.na(t$GarageCars)] <- median(t$GarageCars, na.rm = TRUE)
sum(is.na(t$GarageCars))
t$GarageCars[1117]
#GarageArea
sum(is.na(d$GarageArea))
sum(is.na(t$GarageArea))
which(is.na(t$GarageArea))
t$GarageArea[is.na(t$GarageArea)] <- median(t$GarageArea, na.rm = TRUE)
sum(is.na(t$GarageArea))
t$GarageArea[1117]
#GarageYrBlt
sum(is.na(d$GarageYrBlt))
d$GarageYrBlt[is.na(d$GarageYrBlt)] <- median(d$GarageYrBlt, na.rm = TRUE)
sum(is.na(d$GarageYrBlt))
sum(is.na(t$GarageYrBlt))
t$GarageYrBlt[is.na(t$GarageYrBlt)] <- median(t$GarageYrBlt, na.rm = TRUE)
sum(is.na(t$GarageYrBlt))
#PoolQC
sum(is.na(d$PoolQC))
d$PoolQC = as.factor(ifelse(is.na(d$PoolQC), "No Pool", d$PoolQC))
sum(is.na(d$PoolQC))
table(d$PoolQC)
sum(is.na(t$PoolQC))
t$PoolQC = as.factor(ifelse(is.na(t$PoolQC), "No Pool", t$PoolQC))
sum(is.na(t$PoolQC))
table(t$PoolQC)
#WoodDeckSF
sum(is.na(d$WoodDeckSF))
sum(is.na(t$WoodDeckSF))
#BsmtUnfSF
sum(is.na(d$BsmtUnfSF))
sum(is.na(t$BsmtUnfSF))
t$BsmtUnfSF[is.na(t$BsmtUnfSF)] <- median(t$BsmtUnfSF, na.rm = TRUE)
sum(is.na(t$BsmtUnfSF))
#Combined variables
d <- d %>%
mutate(BsmtSF = BsmtFinSF1 + BsmtFinSF2 + BsmtUnfSF,
Houseage = YrSold - YearBuilt,
Firstandsecondflrsqft = `1stFlrSF` + `2ndFlrSF`,
Totalnumberofbathrooms = BsmtFullBath + FullBath + (BsmtHalfBath*0.5) + (HalfBath*0.5))
t <- t %>%
mutate(BsmtSF = BsmtFinSF1 + BsmtFinSF2 + BsmtUnfSF,
Houseage = YrSold - YearBuilt,
Firstandsecondflrsqft = `1stFlrSF` + `2ndFlrSF`,
Totalnumberofbathrooms = BsmtFullBath + FullBath+ (BsmtHalfBath*0.5) + (HalfBath*0.5))
#Cross-validation
(model <- train((log(SalePrice) ~ OverallQual + Neighborhood*log(GrLivArea) + Fireplaces + YearRemodAdd + MasVnrArea + ExterQual + BsmtQual + BsmtFinType1 + KitchenQual + PoolQC + WoodDeckSF + GarageCars + GarageArea + BsmtSF + Houseage + Firstandsecondflrsqft + Totalnumberofbathrooms), method = 'lm', data = d)) %>%
summary
#Calculate RMSE on the train set
rmse <- function(actual, fitted) sqrt(mean((actual - fitted)^2))
rmse(log(d$SalePrice), fitted(model))
#Estimated Test RMSE and R-squared
model
#Predict on the test set
SalePrice <- predict(model, t)
SalePrice <- exp(SalePrice)
SalePrice %>% glimpse
#Export results to excel
pred <- data.frame(Id = t$Id,
SalePrice)
glimpse(SalePrice)
print(pred)
sum(is.na(pred))
write.csv(pred,"predictions_final.csv", row.names = FALSE)
